{"last_node_id":24,"last_link_id":26,"nodes":[{"id":4,"type":"UNETLoader","pos":[50,50],"size":{"0":315,"1":82},"flags":{},"order":0,"mode":0,"outputs":[{"name":"MODEL","type":"MODEL","links":[1,9],"slot_index":0}],"properties":{"Node name for S&R":"UNETLoader"},"widgets_values":["flux1-dev-fp8.safetensors","fp8_e4m3fn"]},{"id":7,"type":"DualCLIPLoader","pos":[50,160],"size":{"0":315,"1":130},"flags":{},"order":1,"mode":0,"outputs":[{"name":"CLIP","type":"CLIP","links":[2],"slot_index":0}],"properties":{"Node name for S&R":"DualCLIPLoader"},"widgets_values":["clip_l.safetensors","t5xxl_fp8_e4m3fn.safetensors","flux","default"]},{"id":13,"type":"VAELoader","pos":[50,310],"size":{"0":315,"1":58},"flags":{},"order":2,"mode":0,"outputs":[{"name":"VAE","type":"VAE","links":[3],"slot_index":0}],"properties":{"Node name for S&R":"VAELoader"},"widgets_values":["ae.safetensors"]},{"id":3,"type":"CLIPTextEncode","pos":[400,50],"size":{"0":400,"1":200},"flags":{},"order":6,"mode":0,"inputs":[{"name":"clip","type":"CLIP","link":2}],"outputs":[{"name":"CONDITIONING","type":"CONDITIONING","links":[4],"slot_index":0}],"properties":{"Node name for S&R":"CLIPTextEncode"},"widgets_values":["a close-up photograph of a human eye with greenish-blue iris, capturing intricate details"]},{"id":5,"type":"EmptySD3LatentImage","pos":[400,280],"size":{"0":315,"1":106},"flags":{},"order":3,"mode":0,"outputs":[{"name":"LATENT","type":"LATENT","links":[5],"slot_index":0}],"properties":{"Node name for S&R":"EmptySD3LatentImage"},"widgets_values":[1024,1024,1]},{"id":6,"type":"FluxGuidance","pos":[1250,50],"size":{"0":317,"1":58},"flags":{},"order":12,"mode":0,"inputs":[{"name":"conditioning","type":"CONDITIONING","link":4},{"name":"guidance","type":"FLOAT","link":11,"widget":{"name":"guidance"}}],"outputs":[{"name":"CONDITIONING","type":"CONDITIONING","links":[6],"slot_index":0}],"properties":{"Node name for S&R":"FluxGuidance"},"widgets_values":[3.5]},{"id":9,"type":"BasicScheduler","pos":[1250,140],"size":{"0":315,"1":106},"flags":{},"order":13,"mode":0,"inputs":[{"name":"model","type":"MODEL","link":1},{"name":"steps","type":"INT","link":12,"widget":{"name":"steps"}}],"outputs":[{"name":"SIGMAS","type":"SIGMAS","links":[7],"slot_index":0}],"properties":{"Node name for S&R":"BasicScheduler"},"widgets_values":["simple",20,1]},{"id":17,"type":"KSamplerSelect","pos":[1250,270],"size":{"0":315,"1":58},"flags":{},"order":4,"mode":0,"outputs":[{"name":"SAMPLER","type":"SAMPLER","links":[8],"slot_index":0}],"properties":{"Node name for S&R":"KSamplerSelect"},"widgets_values":["euler"]},{"id":1,"type":"BasicGuider","pos":[1600,50],"size":{"0":241.79998779296875,"1":46},"flags":{},"order":14,"mode":0,"inputs":[{"name":"model","type":"MODEL","link":9},{"name":"conditioning","type":"CONDITIONING","link":6}],"outputs":[{"name":"GUIDER","type":"GUIDER","links":[14],"slot_index":0}],"properties":{"Node name for S&R":"BasicGuider"},"widgets_values":[]},{"id":18,"type":"RandomNoise","pos":[1600,120],"size":{"0":315,"1":82},"flags":{},"order":15,"mode":0,"inputs":[{"name":"noise_seed","type":"INT","link":13,"widget":{"name":"noise_seed"}}],"outputs":[{"name":"NOISE","type":"NOISE","links":[15],"slot_index":0}],"properties":{"Node name for S&R":"RandomNoise"},"widgets_values":[12345,"fixed"]},{"id":15,"type":"SamplerCustomAdvanced","pos":[1600,230],"size":{"0":355.20001220703125,"1":106},"flags":{},"order":16,"mode":0,"inputs":[{"name":"noise","type":"NOISE","link":15},{"name":"guider","type":"GUIDER","link":14},{"name":"sampler","type":"SAMPLER","link":8},{"name":"sigmas","type":"SIGMAS","link":7},{"name":"latent_image","type":"LATENT","link":5}],"outputs":[{"name":"output","type":"LATENT","links":[16],"slot_index":0},{"name":"denoised_output","type":"LATENT","links":null}],"properties":{"Node name for S&R":"SamplerCustomAdvanced"},"widgets_values":[]},{"id":16,"type":"VAEDecode","pos":[2000,230],"size":{"0":210,"1":46},"flags":{},"order":17,"mode":0,"inputs":[{"name":"samples","type":"LATENT","link":16},{"name":"vae","type":"VAE","link":3}],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[17,20],"slot_index":0}],"properties":{"Node name for S&R":"VAEDecode"},"widgets_values":[]},{"id":8,"type":"SaveImage","pos":[2250,230],"size":{"0":315,"1":270},"flags":{},"order":18,"mode":0,"inputs":[{"name":"images","type":"IMAGE","link":17}],"properties":{"Node name for S&R":"SaveImage"},"widgets_values":["bayesian_output"]},{"id":2,"type":"LoadImage","pos":[50,400],"size":{"0":315,"1":314},"flags":{},"order":5,"mode":0,"outputs":[{"name":"IMAGE","type":"IMAGE","links":[18,21],"slot_index":0},{"name":"MASK","type":"MASK","links":null}],"properties":{"Node name for S&R":"LoadImage"},"widgets_values":["example.png","image"]},{"id":10,"type":"EnhancedBayesianConfig","pos":[400,420],"size":{"0":380,"1":550},"flags":{},"order":7,"mode":0,"inputs":[{"name":"target_image","type":"IMAGE","link":18}],"outputs":[{"name":"ENHANCED_BAYESIAN_CONFIG","type":"ENHANCED_BAYESIAN_CONFIG","links":[19],"slot_index":0}],"properties":{"Node name for S&R":"EnhancedBayesianConfig"},"widgets_values":["a close-up photograph of a human eye with greenish-blue iris",20,5,1,7,15,30,"normal,simple","euler,dpmpp_2m",0,"",0,0.9,"1:1","Combined",false,0,1000000,42]},{"id":22,"type":"IterationTrigger","pos":[400,1000],"size":{"0":315,"1":106},"flags":{},"order":8,"mode":0,"outputs":[{"name":"counter","type":"INT","links":[23,25],"slot_index":0},{"name":"status","type":"STRING","links":[],"slot_index":1}],"properties":{"Node name for S&R":"IterationTrigger"},"widgets_values":[true,false]},{"id":23,"type":"BayesianIterationManager","pos":[850,420],"size":{"0":380,"1":186},"flags":{},"order":10,"mode":0,"inputs":[{"name":"config","type":"ENHANCED_BAYESIAN_CONFIG","link":19},{"name":"iteration_trigger","type":"INT","link":23,"widget":{"name":"iteration_trigger"}},{"name":"previous_score","type":"FLOAT","link":26,"widget":{"name":"previous_score"}}],"outputs":[{"name":"guidance","type":"FLOAT","links":[11],"slot_index":0},{"name":"steps","type":"INT","links":[12],"slot_index":1},{"name":"seed","type":"INT","links":[13],"slot_index":2},{"name":"is_complete","type":"BOOLEAN","links":[],"slot_index":3},{"name":"status","type":"STRING","links":[],"slot_index":4}],"properties":{"Node name for S&R":"BayesianIterationManager"},"widgets_values":[1,0.5]},{"id":21,"type":"PostGenerationScorer","pos":[2250,540],"size":{"0":315,"1":82},"flags":{},"order":19,"mode":0,"inputs":[{"name":"generated_image","type":"IMAGE","link":20},{"name":"target_image","type":"IMAGE","link":21}],"outputs":[{"name":"similarity_score","type":"FLOAT","links":[26],"slot_index":0},{"name":"report","type":"STRING","links":[24],"slot_index":1},{"name":"comparison_image","type":"IMAGE","links":[],"slot_index":2}],"properties":{"Node name for S&R":"PostGenerationScorer"},"widgets_values":[true]},{"id":20,"type":"ShowText|pysssss","pos":[2600,540],"size":{"0":315,"1":200},"flags":{},"order":20,"mode":0,"inputs":[{"name":"text","type":"STRING","link":24,"widget":{"name":"text"}}],"outputs":[{"name":"STRING","type":"STRING","links":null,"slot_index":0}],"properties":{"Node name for S&R":"ShowText|pysssss"},"widgets_values":["","Similarity report will appear here"]},{"id":24,"type":"AutoQueueManager","pos":[850,650],"size":{"0":315,"1":126},"flags":{},"order":11,"mode":0,"inputs":[{"name":"current_iteration","type":"INT","link":25,"widget":{"name":"current_iteration"}}],"outputs":[{"name":"should_continue","type":"BOOLEAN","links":[],"slot_index":0},{"name":"status","type":"STRING","links":[],"slot_index":1},{"name":"next_iteration","type":"INT","links":[],"slot_index":2}],"properties":{"Node name for S&R":"AutoQueueManager"},"widgets_values":[20,1,true]},{"id":19,"type":"Note","pos":[400,1150],"size":{"0":800,"1":250},"flags":{},"order":9,"mode":0,"properties":{"text":""},"widgets_values":["AUTOMATED WORKFLOW WITHOUT CIRCULAR DEPENDENCIES\n\n1. The IterationTrigger counts iterations (increment=true, reset=false)\n2. BayesianIterationManager receives the trigger and manages parameters\n3. Image is generated with suggested parameters\n4. PostGenerationScorer calculates similarity AFTER generation (no loop)\n5. Similarity score is saved to state file for next iteration\n6. AutoQueueManager determines if more iterations are needed\n\nTo run:\n1. Set reset=true in IterationTrigger, run once, then set reset=false\n2. Run the workflow 20 times using browser console:\n   for(let i = 0; i < 20; i++) {\n       setTimeout(() => document.querySelector('#queue-button').click(), i * 10000);\n   }\n\nThe similarity scores are accumulated in the state file and used to improve parameters\nwithout creating any circular dependencies in the workflow."],"color":"#432","bgcolor":"#653"}],"links":[[1,4,0,9,0,"MODEL"],[2,7,0,3,0,"CLIP"],[3,13,0,16,1,"VAE"],[4,3,0,6,0,"CONDITIONING"],[5,5,0,15,4,"LATENT"],[6,6,0,1,1,"CONDITIONING"],[7,9,0,15,3,"SIGMAS"],[8,17,0,15,2,"SAMPLER"],[9,4,0,1,0,"MODEL"],[11,23,0,6,1,"FLOAT"],[12,23,1,9,1,"INT"],[13,23,2,18,0,"INT"],[14,1,0,15,1,"GUIDER"],[15,18,0,15,0,"NOISE"],[16,15,0,16,0,"LATENT"],[17,16,0,8,0,"IMAGE"],[18,2,0,10,0,"IMAGE"],[19,10,0,23,0,"ENHANCED_BAYESIAN_CONFIG"],[20,16,0,21,0,"IMAGE"],[21,2,0,21,1,"IMAGE"],[23,22,0,23,1,"INT"],[24,21,1,20,0,"STRING"],[25,22,0,24,0,"INT"],[26,21,0,23,2,"FLOAT"]],"groups":[],"config":{},"extra":{},"version":0.4}